GO
USE MASTER
GO
IF DB_ID('LTWin_DTQLTV')IS NOT NULL
	PRINT('DA CO DU LIEU')
ELSE
 CREATE DATABASE LTWin_DTQLTV	



GO
use LTWin_DTQLTV
IF EXISTS (SELECT*FROM sys.objects WHERE name = 'DOCGIA')
BEGIN
DROP TABLE DOCGIA
PRINT ('DA CO')
END 
ELSE 
 CREATE TABLE DOCGIA
(
MADG VARCHAR(10) PRIMARY KEY NOT NULL,
TENDG NVARCHAR(30),
GIOITINH BIT,
NGAYSINH SMALLDATETIME,
SDT CHAR(11),
DIACHI NVARCHAR(50),
NGAYLAPTHE SMALLDATETIME,
NGAYHETHAN SMALLDATETIME,
TIENCOC MONEY,
GHICHU NVARCHAR(50),
HINHANH image,
)

GO
IF EXISTS (SELECT*FROM sys.objects WHERE name = 'SACH')
BEGIN
DROP TABLE SACH
PRINT ('DA CO')
END 
ELSE 
 CREATE TABLE SACH
(
MASACH VARCHAR(10) PRIMARY KEY NOT NULL,
TENSACH NVARCHAR(50),
CHUDE NVARCHAR(30),
TACGIA NVARCHAR(30),
NXB NVARCHAR(30),
SLNHAP INT,
DONGIA INT,
TINHTRANG NVARCHAR(20),
NCC NVARCHAR(30),
GHICHU NVARCHAR(50),
HINHANH image,
)

GO
IF EXISTS (SELECT*FROM sys.objects WHERE name = 'HSMUONTRA')
BEGIN
DROP TABLE HSMUONTRA
PRINT ('DA CO')
END 
ELSE 
 CREATE TABLE HSMUONTRA
(
MAMT VARCHAR(10) PRIMARY KEY NOT NULL,
MADG VARCHAR(10),
TENDG NVARCHAR(30),
TENSACH NVARCHAR(30),
NGAYLAPPHIEU SMALLDATETIME,
GHICHU NVARCHAR(50),
)

GO
IF EXISTS (SELECT*FROM sys.objects WHERE name = 'NCC')
BEGIN
DROP TABLE NCC
PRINT ('DA CO')
END 
ELSE 
 CREATE TABLE NCC
(
MANCC VARCHAR(10) PRIMARY KEY NOT NULL,
TENNCC NVARCHAR(30),
SDT CHAR(11),
DIACHI NVARCHAR(50),
)

GO
IF EXISTS (SELECT*FROM sys.objects WHERE name = 'CTMUONTRA')
BEGIN
DROP TABLE CTMUONTRA
PRINT ('DA CO')
END 
ELSE 
 CREATE TABLE CTMUONTRA
(
MAMT VARCHAR(10) ,
MASACH VARCHAR(10),
NGAYMUON SMALLDATETIME,
NGAYHENTRA SMALLDATETIME,
TINHTRANG NVARCHAR(20),
SLMUON INT,
GHICHU NVARCHAR(50),
CONSTRAINT PK_CTMUONTRA PRIMARY KEY(MAMT,MASACH)
)


GO
IF EXISTS (SELECT*FROM sys.objects WHERE name = 'NCC_SACH')
BEGIN
DROP TABLE NCC_SACH
PRINT ('DA CO')
END 
ELSE 
 CREATE TABLE NCC_SACH
(
MANCC VARCHAR(10) ,
MASACH VARCHAR(10),
SOBAN INT,
DONGIA MONEY,

CONSTRAINT PK_NCCSACH PRIMARY KEY(MANCC,MASACH)
)
ALTER TABLE CTMUONTRA ADD CONSTRAINT CHK_CTMUONTRA CHECK (SLMUON>=0 AND SLMUON<=3)

ALTER TABLE HSMUONTRA ADD CONSTRAINT FK_HSMUONTRA FOREIGN KEY(MADG) REFERENCES DOCGIA(MADG)
ALTER TABLE CTMUONTRA ADD CONSTRAINT FK_CTMUONTRA FOREIGN KEY(MAMT) REFERENCES HSMUONTRA(MAMT)
ALTER TABLE CTMUONTRA ADD CONSTRAINT FK_CTMUONTRA1 FOREIGN KEY(MASACH) REFERENCES SACH(MASACH)
ALTER TABLE NCC_SACH ADD CONSTRAINT FK_NCCSACH FOREIGN KEY(MASACH) REFERENCES SACH(MASACH)
ALTER TABLE NCC_SACH ADD CONSTRAINT FK_NCCSACH1 FOREIGN KEY(MANCC) REFERENCES NCC(MANCC)

create table tblThuThu
(
	MaTT varchar(10) constraint pk_tblThuThu primary key,
	TenTT nvarchar(30),
	GioiTinhTT bit,
	NgaySinhTT smalldatetime,
	SDTTT varchar(11),
	DiaChiTT nvarchar(50),
	GhiChu nvarchar(30),
	TenTaiKhoanTT varchar(10),
	MatKhauTT varchar(32),
)
--drop table tblThuThu

--drop table CTMUONTRA
--drop table HSMUONTRA
--drop table NCC_SACH
--drop table NCC
--drop table DOCGIA
--drop table SACH

INSERT INTO DOCGIA(MADG,TENDG,GIOITINH,NGAYSINH,SDT,DIACHI,NGAYLAPTHE,NGAYHETHAN,TIENCOC,GHICHU)
VALUES ('DG001',N'Nguyễn Văn A',1,'5-16-1995','0987654321',N'172 Lê Đức Thọ, Gò Vấp','12-18-2017','12-18-2021','1000000',N'')
INSERT INTO DOCGIA(MADG,TENDG,GIOITINH,NGAYSINH,SDT,DIACHI,NGAYLAPTHE,NGAYHETHAN,TIENCOC,GHICHU)
VALUES ('DG002',N'Lê Văn B',1,'8-16-1994','0987654323',N'496 Lê Đức Thọ, Gò Vấp','12-18-2017','12-18-2021','1000000',N'')
INSERT INTO DOCGIA(MADG,TENDG,GIOITINH,NGAYSINH,SDT,DIACHI,NGAYLAPTHE,NGAYHETHAN,TIENCOC,GHICHU)
VALUES ('DG003',N'Trần Văn C',1,'4-24-1995','0987654324',N'172 Dương Quảng Hàm, Gò Vấp','12-18-2017','12-18-2021','1000000',N'')
INSERT INTO DOCGIA(MADG,TENDG,GIOITINH,NGAYSINH,SDT,DIACHI,NGAYLAPTHE,NGAYHETHAN,TIENCOC,GHICHU)
VALUES ('DG004',N'Lê Thị D',0,'8-2-1996','0987654325',N'496 Dương Quảng Hàm, Gò Vấp','9-18-2017','9-18-2021','1000000',N'')

INSERT INTO NCC(MANCC,TENNCC,SDT,DIACHI)
VALUES ('NCC012',N'Nhà cung cấp A','0872569554','123 CMT8 Hồ Chí Minh')
INSERT INTO NCC(MANCC,TENNCC,SDT,DIACHI)
VALUES ('NCC013',N'Nhà cung cấp B','0872569553','1234 Phạm Văn Đồng Hồ Chí Minh')
INSERT INTO NCC(MANCC,TENNCC,SDT,DIACHI)
VALUES ('NCC014',N'Nhà cung cấp C','0872569555','23 Phan Văn Trị Hồ Chí Minh')
INSERT INTO NCC(MANCC,TENNCC,SDT,DIACHI)
VALUES ('NCC015',N'Nhà cung cấp D','0872569556','1 Nguyễn Oanh Hồ Chí Minh')

INSERT INTO SACH(MASACH,TENSACH,CHUDE,TACGIA,NXB,SLNHAP,DONGIA,TINHTRANG,NCC,GHICHU)
VALUES ('MS001',N'abc',N'Truyện tranh',N'Nguyễn Oanh',N'NXB 1',123,12000,N'',N' Nhà cung cấp A',N'')
INSERT INTO SACH(MASACH,TENSACH,CHUDE,TACGIA,NXB,SLNHAP,DONGIA,TINHTRANG,NCC,GHICHU)
VALUES ('MS002',N'bcd',N'Truyện Phím',N'Puskin',N'NXB 2',100,10000,N'',N' Nhà cung cấp B',N'')
INSERT INTO SACH(MASACH,TENSACH,CHUDE,TACGIA,NXB,SLNHAP,DONGIA,TINHTRANG,NCC,GHICHU)
VALUES ('MS004',N'pokemon',N'Truyện tranh',N'Nguyễn Oanh',N'NXB 1',50,12000,N'',N' Nhà cung cấp C',N'')
INSERT INTO SACH(MASACH,TENSACH,CHUDE,TACGIA,NXB,SLNHAP,DONGIA,TINHTRANG,NCC,GHICHU)
VALUES ('MS003',N'doremon',N'Truyện tranh',N'Puskin',N'NXB 2',75,10000,N'',N' Nhà cung cấp D',N'')

INSERT INTO HSMUONTRA(MAMT,MADG,TENDG,TENSACH,NGAYLAPPHIEU,GHICHU)
VALUES ('MP001','DG001',N'Nguyễn Văn A',N'abc','5-16-2017',N'')
INSERT INTO HSMUONTRA(MAMT,MADG,TENDG,TENSACH,NGAYLAPPHIEU,GHICHU)
VALUES ('MP002','DG001',N'Nguyễn Văn A',N'abc','5-16-2017',N'')
INSERT INTO HSMUONTRA(MAMT,MADG,TENDG,TENSACH,NGAYLAPPHIEU,GHICHU)
VALUES ('MP003','DG002',N'Le Văn A',N'abc','5-16-2017',N'')
INSERT INTO HSMUONTRA(MAMT,MADG,TENDG,TENSACH,NGAYLAPPHIEU,GHICHU)
VALUES ('MP004','DG003',N'Trần Văn C',N'abc','5-16-2017',N'')

INSERT INTO CTMUONTRA(MAMT,MASACH,NGAYMUON,NGAYHENTRA,TINHTRANG,SLMUON,GHICHU)
VALUES ('MP001','MS001','5-16-2017','6-16-2017',N'Mới',1,N'')
INSERT INTO CTMUONTRA(MAMT,MASACH,NGAYMUON,NGAYHENTRA,TINHTRANG,SLMUON,GHICHU)
VALUES ('MP002','MS002','5-16-2017','6-16-2017',N'Mới',1,N'')
INSERT INTO CTMUONTRA(MAMT,MASACH,NGAYMUON,NGAYHENTRA,TINHTRANG,SLMUON,GHICHU)
VALUES ('MP003','MS003','5-16-2017','6-16-2017',N'Mới',1,N'')
INSERT INTO CTMUONTRA(MAMT,MASACH,NGAYMUON,NGAYHENTRA,TINHTRANG,SLMUON,GHICHU)
VALUES ('MP004','MS004','5-16-2017','6-16-2017',N'Mới',1,N'')


INSERT INTO NCC_SACH(MANCC,MASACH,SOBAN,DONGIA)
VALUES ('NCC013','MS001',150,12000)
INSERT INTO NCC_SACH(MANCC,MASACH,SOBAN,DONGIA)
VALUES ('NCC012','MS001',200,12000)
INSERT INTO NCC_SACH(MANCC,MASACH,SOBAN,DONGIA)
VALUES ('NCC014','MS001',200,12000)

insert into tblThuThu values ('TT001',N'Thiều Sỹ Tùng',0,'2-15-2015 7:45:00','0974633324',N'115 Lê Đức Thọ, Gò Vấp','...','TT001','202CB962AC59075B964B07152D234B70')
insert into tblThuThu values ('TT002',N'Vũ Đình Cần',1,'2-15-2015 7:45:00','0974633324',N'115 Lê Đức Thọ, Gò Vấp','...','TT002','202CB962AC59075B964B07152D234B70')
insert into tblThuThu values ('TT003',N'Nguyễn Như Trãi',1,'2-15-2015','0974633324',N'115 Lê Đức Thọ, Gò Vấp','...','TT003','202CB962AC59075B964B07152D234B70')

